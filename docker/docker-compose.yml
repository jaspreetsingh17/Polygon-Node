version: '3.8'

services:
  heimdall:
    image: maticnetwork/heimdall:latest
    container_name: heimdall
    restart: unless-stopped
    ports:
      - "26656:26656"
      - "26657:26657"
      - "1317:1317"
    volumes:
      - heimdall-data:/heimdall-home
    environment:
      - HEIMDALL_DIR=/heimdall-home
      - ETH_RPC_URL=${ETH_RPC_URL:-http://host.docker.internal:8545}
    command: start --home /heimdall-home
    networks:
      - polygon-network
    extra_hosts:
      - "host.docker.internal:host-gateway"

  bor:
    image: maticnetwork/bor:latest
    container_name: bor
    restart: unless-stopped
    depends_on:
      - heimdall
    ports:
      - "30303:30303/tcp"
      - "30303:30303/udp"
      - "8545:8545"
      - "8546:8546"
    volumes:
      - bor-data:/bor-home
    environment:
      - BOR_DIR=/bor-home
    command: >
      server
      --datadir /bor-home
      --chain mainnet
      --http
      --http.addr 0.0.0.0
      --http.port 8545
      --http.vhosts '*'
      --http.corsdomain '*'
      --http.api eth,net,web3,txpool,bor
      --ws
      --ws.addr 0.0.0.0
      --ws.port 8546
      --ws.origins '*'
      --bor.heimdall http://heimdall:1317
      --maxpeers 50
      --cache 4096
    networks:
      - polygon-network

volumes:
  heimdall-data:
  bor-data:

networks:
  polygon-network:
    driver: bridge
